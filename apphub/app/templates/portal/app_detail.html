{% extends "_layout.html" %}
{% block content %}
  <div class="header">
    <div>
      <h1>{{ app.name }}</h1>
      <p class="muted">{{ app.description }}</p>
      <div>
        <span class="badge">{{ app.type | upper }}</span>
        <span class="tag">Owner: {{ app.owner_team }}</span>
      </div>
    </div>
    {% if app.type in ['web', 'both'] and app.web_url %}
      <a class="button" href="{{ app.web_url }}" target="_blank" rel="noopener">Launch web app</a>
    {% endif %}
  </div>

  <div class="grid cols-2">
    <div class="card">
      <h3>Ownership</h3>
      <p><strong>Team:</strong> {{ app.owner_team }}</p>
      <p><strong>Support:</strong> <a href="mailto:{{ app.support_contact }}">{{ app.support_contact }}</a></p>
      <div style="margin-top: 12px;">
        {% for tag in app.tags or [] %}
          <span class="tag">{{ tag }}</span>
        {% endfor %}
      </div>
    </div>
    <div class="card">
      <h3>Release notes</h3>
      {% for release in releases %}
        <div style="margin-bottom: 16px;">
          <strong>{{ release.version }}</strong>
          <p class="muted">{{ release.release_date.strftime('%Y-%m-%d') }}</p>
          <p>{{ release.notes }}</p>
          {% if release.changelog %}<p class="muted">{{ release.changelog }}</p>{% endif %}
        </div>
      {% else %}
        <p class="muted">No releases yet.</p>
      {% endfor %}
    </div>
    <div class="card" style="grid-column: span 2;">
      <h3>Downloads</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Platform</th>
            <th>Arch</th>
            <th>Version</th>
            <th>SHA256</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for file in files %}
            <tr>
              <td>{{ file.platform }}</td>
              <td>{{ file.arch }}</td>
              <td>{{ file.version }}</td>
              <td>
                <code>{{ file.sha256 }}</code>
                <button class="button ghost" type="button" data-copy="{{ file.sha256 }}">Copy</button>
              </td>
              <td>
                <a class="button" href="{{ request.scope.root_path }}/download/{{ file.id }}">Download</a>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="5">No downloadable files.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <p class="muted">Need help? <a href="mailto:{{ app.support_contact }}">Report a problem</a></p>
    </div>
  </div>

  <div class="card" style="margin-top: 24px;">
    <h3>Media</h3>
    <div class="grid cols-3">
      {% for item in media %}
        <div class="card">
          <img src="{{ request.scope.root_path }}/media/{{ item.id }}" alt="{{ item.caption }}" style="width: 100%; border-radius: 12px;" />
          <p class="muted">{{ item.caption }}</p>
        </div>
      {% else %}
        <p class="muted">No screenshots yet.</p>
      {% endfor %}
    </div>
  </div>
{% endblock %}
