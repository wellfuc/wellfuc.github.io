{% extends "_layout.html" %}
{% block content %}
  <div class="header">
    <div>
      <h1>{{ 'Edit app' if app else 'New app' }}</h1>
      <p class="muted">Configure metadata, owners, and categories.</p>
    </div>
  </div>
  <form class="card" method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
    <div class="form-row">
      <label>Name
        <input class="input" name="name" value="{{ app.name if app else '' }}" required />
      </label>
      <label>Type
        <select class="select" name="type">
          {% for option in ['web', 'desktop', 'both'] %}
            <option value="{{ option }}" {% if app and app.type == option %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
      <label>Status
        <select class="select" name="status">
          {% for option in ['active', 'maintenance', 'deprecated'] %}
            <option value="{{ option }}" {% if app and app.status == option %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      </label>
    </div>
    <label>Description
      <textarea class="textarea" name="description">{{ app.description if app else '' }}</textarea>
    </label>
    <div class="form-row">
      <label>Owner team
        <input class="input" name="owner_team" value="{{ app.owner_team if app else '' }}" />
      </label>
      <label>Support contact
        <input class="input" name="support_contact" value="{{ app.support_contact if app else '' }}" />
      </label>
      <label>Web launch URL
        <input class="input" name="web_url" value="{{ app.web_url if app else '' }}" />
      </label>
      <label>Tags (comma separated)
        <input class="input" name="tags" value="{{ (app.tags | join(', ')) if app else '' }}" />
      </label>
    </div>
    <fieldset>
      <legend>Categories</legend>
      <div class="form-row">
        {% for category in categories %}
          <label>
            <input type="checkbox" name="categories" value="{{ category.id }}" {% if category.id in selected_categories %}checked{% endif %} />
            {{ category.name }}
          </label>
        {% endfor %}
      </div>
    </fieldset>
    <label>
      <input type="checkbox" name="featured" {% if app and app.featured %}checked{% endif %} />
      Featured app
    </label>
    <div style="margin-top: 16px; display: flex; gap: 12px;">
      <button class="button" type="submit">Save</button>
    </div>
  </form>
  {% if app %}
    <form method="post" action="{{ request.scope.root_path }}/admin/apps/{{ app.id }}/delete" style="margin-top: 12px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
      <button class="button secondary" type="submit">Soft delete</button>
    </form>
  {% endif %}
{% endblock %}
