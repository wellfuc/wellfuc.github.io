{% extends "_layout.html" %}
{% block content %}
  <div class="header">
    <div>
      <h1>{{ 'Edit release' if release else 'New release' }}</h1>
      <p class="muted">Highlight what changed and when.</p>
    </div>
  </div>
  <form class="card" method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
    <div class="form-row">
      <label>App
        <select class="select" name="app_id" required>
          {% for app in apps %}
            <option value="{{ app.id }}" {% if release and release.app_id == app.id %}selected{% endif %}>{{ app.name }}</option>
          {% endfor %}
        </select>
      </label>
      <label>Version
        <input class="input" name="version" value="{{ release.version if release else '' }}" required />
      </label>
      <label>Release date
        <input class="input" type="datetime-local" name="release_date" value="{{ release.release_date.strftime('%Y-%m-%dT%H:%M') if release else '' }}" required />
      </label>
    </div>
    <label>Release notes
      <textarea class="textarea" name="notes">{{ release.notes if release else '' }}</textarea>
    </label>
    <label>Changelog
      <textarea class="textarea" name="changelog">{{ release.changelog if release else '' }}</textarea>
    </label>
    <div style="margin-top: 16px; display: flex; gap: 12px;">
      <button class="button" type="submit">Save</button>
    </div>
  </form>
  {% if release %}
    <form method="post" action="{{ request.scope.root_path }}/admin/releases/{{ release.id }}/delete" style="margin-top: 12px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
      <button class="button secondary" type="submit">Soft delete</button>
    </form>
  {% endif %}
{% endblock %}
